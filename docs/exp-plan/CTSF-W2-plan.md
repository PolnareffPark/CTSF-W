# **W2 실험, 동적(문맥 의존) 교차 vs. 정적(고정) 교차** 〔**필수**·재학습〕

### 목적

- **왜 동적이어야 하는가?** GRU 상태(문맥)에 따라 CNN 필터/출력 가중이 **매 스텝 달라져야** 하는지 확인합니다.
    

### 근거(직접 인용)

- Dynamic Filter Networks: “A dynamic filter module … **produces filters conditioned on an input**.”(입력에 조건지어진 필터 생성) ([NeurIPS Papers](https://papers.neurips.cc/paper/6578-dynamic-filter-networks.pdf?utm_source=chatgpt.com "Dynamic Filter Networks"))
    
- HyperNetworks: “**use a hypernetwork to generate weights for another neural network**.”(다른 네트의 가중치를 생성) ([deepsense.ai](https://deepsense.ai/wp-content/uploads/2023/03/1609.09106.pdf?utm_source=chatgpt.com "HyperNetworks"))  
    → **문맥/입력 조건부** 가중 생성이 **적응성·성능 향상**으로 이어짐(일반 원리).
    

### 모델 조작

- **원안(Dynamic)**: CrossHyperConv의 **입력/상태 조건부** 결합(현행).
    
- **대조(Static)**: 동일 채널수의 **고정 1×1 conv**(또는 학습 스칼라)로 **입력 비의존** 결합. 파라미터/FLOPs **±3% 매칭**(B1로 검증).
    
- HP2 동일.
    

### 평가·통계

- **주지표**: RMSE/MAE.
    
- **직접 근거**: TOD 민감도(둘 다 **상승**해야 함), 피크/시차 지표(ETTh2에서 **개선폭**↑).
    
- **판정**: Dynamic **>** Static (특히 **ETTm2: TOD**, **ETTh2: 시차/피크**).
    

### 기대 관찰/해석

- 정적 결합은 **시간대/상황 변화**를 반영 못 함 → **문맥 적응 저하**. 동적 결합은 **현재 상태**에 맞춘 가중으로 **강조/완화**가 가능.
    

### 보고 형식

- 표: ΔRMSE(Dyn − Static), ΔTOD 민감도, Δ피크/시차.
    
- 그림: **시간대‑별 필터 민감도 히트맵**(샘플).

## **W1 실험 필수 보완 항목: 파라미터/연산량 통제(공정 비교)** 〔**필수 보완**〕

### 목적

- 성능 이득이 **교차 설계** 때문인지, **용량/연산 증가** 때문인지 분리.
    

### 근거(직접 인용)

- 효율 비교의 함정(“공정 비교” 언급): “**A seemingly fair comparison … compute matched**.”(계산량 매칭) 그러나 모델 축소 등 **비공정** 유발 가능 지적 ([arXiv](https://arxiv.org/pdf/2110.12894?utm_source=chatgpt.com "the efficiency misnomer"))  
    → 본 연구는 역으로, **FLOPs/파라미터 ±3% 이내**로 **양측을 맞춘 대조군**을 두어 **설계 자체의 효과**를 분리.
    

### 모델 조작

- A2/A3 대조군을 **FLOPs·파라미터 매칭**으로 재튜닝(채널·1×1폭 조정).
    
- HP2 동일.
    

### 평가·통계/판정

- ΔRMSE와 직접 지표 **차이값**에 대해 **대응 검정**. **CTSF(both) ≥ 매칭 대조군**이면 **설계 효과**로 귀속.

---

W2 실험 – 동적 교차 vs. 정적 교차
[배경 및 필요성]: W1이 “어디서 교차하느냐”를 다뤘다면, W2는 “어떻게 교차하느냐”에 대한 실험입니다. CTSF의 교차 연결은 GRU의 상태 (문맥)에 따라 CNN 필터/출력 가중치가 매 스텝 달라지는 동적(hypernet) 결합인데, 이러한 동적 특성이 없다면 어떻게 될까요? 본 실험은 “왜 교차 연결이 동적으로 이루어져야 하는가?”를 검증합니다. 이는 입력-조건부 가중치 생성이라는 일반 원리가 시계열 모델에서 성능 향상에 기여하는지 확인하는 작업입니다.
[실험 목적]: Dynamic Cross (문맥 의존)와 Static Cross (고정 가중)의 예측 성능을 비교합니다. 즉, 현재 시점의 GRU hidden state를 반영하여 CNN 쪽 가중치를 생성하는 현행 방식을, 동일 용량의 고정 결합 방식으로 대체하여 성능 차이를 관찰합니다. 이를 통해 문맥에 따른 가중 동조의 효과를 규명합니다.
[이론적 근거]: 맥락 적응의 장점은 여러 연구에서 제시되어 왔습니다: - Dynamic Filter Networks에서는 “A dynamic filter module … produces filters conditioned on an input.”[20]라고 하며, 입력에 따라 달라지는 필터가 고정 필터보다 유연한 표현을 제공하여 성능을 높일 수 있음을 보였습니다. (예: 동적 필터를 이용한 비디오 프레임 예측 등에서 향상 결과 보고) → 문맥/입력 조건부 필터 생성은 모델의 적응성을 높이고, 다양한 상황에 대응하는 데 유리하다는 일반 원리입니다. - HyperNetworks 역시 “use a hypernetwork to generate weights for another neural network.”[21]라 하여, 한 네트워크의 출력을 다른 네트워크의 가중치로 생성하면 매개변수 효율을 높이면서 성능 향상을 가져올 수 있다고 합니다. → 즉, 조건부 가중치 생성을 통해 표현력 증대와 효율 개선을 달성하는 사례로, CTSF의 교차 연결도 일종의 hypernetwork 개념을 활용하고 있습니다.
[모델 조작]: - 원안 (Dynamic): 기존 CTSF의 CrossHyperConv 모듈 그대로 사용합니다. GRU 경로의 hidden state (혹은 CNN 경로 출력)을 입력으로 받아 계산된 계수로 CNN 쪽 활성화를 재가중하는 입력 의존적 결합이 수행됩니다. - 대조군 (Static): 교차 연결을 입력 불변의 고정 가중치 결합으로 바꿉니다. 구현은 두 가지 가능: (i) 1×1 Conv 고정: 동적 hypernetwork를 동일 채널 수의 1×1 convolution으로 대체하여, 학습은 하지만 시간에 따라 값이 변하지 않는 고정 결합으로 만듭니다. 또는 (ii) 학습가능 스칼라 게이트: 각 경로 출력에 대해 하나의 학습 파라미터(스칼라)를 두어 그 비율로 섞는 방식. 둘 중 어떤 방식을 써도 무방하나, 파라미터/FLOPs 수를 Dynamic과 ±3% 이내로 맞추도록 채널 폭 등을 조정합니다 (B1 실험으로 사전 검증). - 설정: 나머지 하이퍼파라미터, 학습 조건 (HP2) 동일. 단지 교차 모듈이 dynamic vs static으로 다를 뿐입니다.
[평가 지표 및 분석]: - 주요 지표: RMSE, MAE 등을 비교하여 전반적인 예측 성능 차이를 확인합니다. Dynamic이 Static보다 낮은 오류를 보여야 합니다. - 직접 지표: Dynamic의 이점은 시간대별 민감한 조정과 급변 대응으로 나타날 것이므로, TOD 민감도 지표와 피크 검출/시차 지표를 중점적으로 봅니다. 두 모델 모두 일정 부분 시간대에 반응하겠지만, Dynamic 쪽에서 특히 ETTh2 등의 데이터에서 피크 검출 능력이 향상되고 반응 시차가 짧아지는(즉, 더 신속히 반응) 양상을 기대합니다. Spearman 상관 등 경로 간 상관분석도 수행하여 dynamic일 때 CNN-GRU 경로 상관관계가 더 높거나 (협조적으로 움직임) 하는지를 살펴볼 것입니다. - 통계 검정: W1과 마찬가지로 대응 t-검정으로 유의미한 차이인지 확인합니다. 또, 특정 데이터/시간대에서 차이가 뚜렷한지를 추가 분석합니다 (예: ETTm2의 낮 시간대 성능 vs 정적 모델 비교 등).
•	판정 기준: Dynamic 모델이 Static 모델보다 RMSE, MAE 모두 개선되고, TOD 민감도는 dynamic 쪽이 높게 (즉 시간대에 따라 가중치 잘 조정) 나타나며, 피크/시차 지표도 개선폭이 관찰되면 동적 설계의 승리로 판정합니다. 특히 ETTm2 (15분 간격) 데이터는 일중 변동이 커서 동적 적응의 효과가 클 것으로, ETTh2 (1시간 간격) 데이터는 피크 패턴이 뚜렷하여 피크 탐지 이득이 클 것으로 예상합니다.
[기대되는 해석]: - Static 결합에서는 교차 가중치가 모든 시점에 고정되므로, 시간대/상황 변화를 반영하지 못합니다. 이는 특정 시간 구간에서는 부적절한 가중치 적용으로 문맥 적응력이 저하되고 일부 패턴을 놓치는 결과로 이어집니다. 예를 들어 야간과 주간 수요 패턴이 다른데도 동일한 결합 비율을 쓰면 최적이 아닐 수 있습니다. - Dynamic 결합은 현재 GRU 상태에 맞추어 CNN 필터나 출력을 강조 혹은 완화하므로, 맥락에 따른 조정이 일어납니다. 급격한 상승 신호가 감지되면 GRU의 상태변화로 CNN 경로의 특정 필터 출력을 증폭시키고, 반대로 완만한 구간에서는 불필요한 과민 반응을 줄이는 식입니다. 그 결과 Static 대비 예측 오차를 줄이고, 극한 상황에 더 잘 대응하게 됩니다. - 본 실험이 통과되면, 동적 Hypernetwork 구성의 타당성이 입증되어 CTSF의 설계 원리가 강화됩니다. 반대로 차이가 미미하다면, simpler한 정적 설계로도 충분했을 가능성을 고려해야 합니다.
[결과 보고 형식]: - 표: Dynamic – Static의 ΔRMSE, ΔTOD 지표, Δ피크/시차 지표를 나열해 어떤 면에서 얼마나 향상되었는지 보여줍니다. - 그래프: 시간대별 필터 민감도 히트맵 등 시각화를 통해 Static 대비 Dynamic에서 필터 가중치가 어떻게 상황에 따라 달라지는지 한 사례를 제시합니다 (예: dynamic 모델의 layer별 gate 값이 24시간 주기로 어떻게 변동하는지).
